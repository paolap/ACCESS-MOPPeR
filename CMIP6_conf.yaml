################################################################
# USER OPTIONS
# Settings to manage cmorisation and set tables/variables to process
# This config file is to produce files to submit to CMIP6 project
# It's more restrictive than ACDD_conf.yaml
# This configuration file example covers both CMIP6 and CMIP6Plus requirements
# with the following differences
# In the global attributes:
# -further-info-url and product are not required for CMIP6Plus
# CVs are different, so for experiments and source defintions refer to relevant CV
# CMIP6Plus uses https://github.com/PCMDI/mip-cmor-tables
# CMIP6 uses https://github.com/PCMDI/cmip6-cmor-tables/tree/main
cmor:
    # If test true it will just run the setup but not launch the job automatically
    test: false
    # working directory if default uses current directory
    appdir:  default
    # output directory for all generated data (CMORISED files & logs)
    # if default it is set to /scratch/$project/$user/MOPPER_OUTPUT<exp>
    outpath: default
    # if true override files already existing in outpath 
    override: !!bool true
    # location of input data must point to dir above experiment;
    #  and experiment subdir must contain atmos/[,ocean/, ice/]
    datadir: /g/data/...
    # from exp_to_process: local name of experiment
    exp: expid
    # Interval to cmorise inclusive of end_date
    # NB this will be used to select input files to include
    start_date: "09500101"                        
    end_date: "09501231"                        
    # select one of: [CM2, ESM, OM2[-025]]
    access_version: CM2 
    # reference date for time units (set as 'default' to use START_YEAR)
    #reference_date: "0950-01-01"              
    reference_date: default              
    # official CMIP6
    path_template: "{mip_era}/{activity_id}/{institution_id}/{source_id}/{experiment_id}/{member_id}/{table_id}/{variable_id}/{grid_label}/{version}"
    file_template: "{variable_id}_{table_id}_{source_id}_{experiment_id}_{member_id}_{grid_label}"
    #NB member_id is <sub_experiment_id>-<variant_label> if it's sub-experiment or just <variant_label> 
    # maximum file size in MB: this is meant as uncompressed, compression might reduce it by 50%
    max_size: 8192
    # deflate_level sets the internal compression level, 
    # level 4-6 good compromise between reducing size and write/read speed
    # shuffle 0: off 1:on Shuffle reduces size without impacting speed
    # NB make sure this is inline with CMIP requirements
    deflate_level: 4
    shuffle: 1

    # Variables to CMORise: 
    # CMOR table/variable to process; default is 'all'.
    # 'all' will use all the tables listed in the mapping file
    # Or create a yaml file listing variables to process (VAR_SUBSET[_LIST]).
    # each line: <table: [var1, var2, var3 ..]>
    tables: CMIP6_Amon 
    # use MIP-CMOR tables for CMIP6Plus
    #tables: MIP_APmon 
    variable_to_process: tas
    var_subset: !!bool False
    var_subset_list: ''
    # if subhr data is included specify actual frequency as ##min
    subhr: 10min
    # model vertical levels number
    levnum: 85
    # Mappings, vocab and tables settings
    # default=data/dreq/cmvme_all_piControl_3_3.csv
    # dreq not available for CMIP6Plus
    dreq: default
    # Set to true to use dreq
    # It should be False for CMIP6Plus
    force_dreq: !!bool True
    dreq_years: !!bool False
    # mapping file created with cli_db.py based on the actual model output
    master_map: "data/master_cm000.csv"
    # use this to indicate the path used for new or modified tables
    # these will be used in preference to the package tables
    # as you should use official CMOR cmip6 tables for CMIP6 mode
    # use this only if current package version is obsolete
    tables_path: ""
    # Ancil files are needed only for specific variables when
    # grid information is not fully available from output
    # you can usually leave these empty if processing only atmos
    # ancillary files relative path to <appdir> or fullpath
    ancils_path: "localdata/ancils"
    # grid ocean is the auscom grid file t retrieve lat/lon and their vertices
    # example is for om2, cm2, esm1.5 versions
    grid_ocean: "grid_spec.auscom.20110618.nc"
    grid_seaIce: ""
    mask_ocean: ""
    # to supply land area fraction if not available in output
    land_frac: ""
    # to supply tile area fraction if not available in output
    tile_frac: ""
    # used for atmospheric hybrid coordinates
    orog: ""
    history_data: ''
    # DO NOT REMOVE OR ALTER this if you don't know what you're doing :-)
    # defines Controlled Vocabularies and required attributes
    _control_vocabulary_file: "CMIP6_CV.json"
    # for CMIP6Plus use
    #_control_vocabulary_file: "CMIP6Plus_CV.json"
    _cmip6_option: CMIP6
    _AXIS_ENTRY_FILE: CMIP6_coordinate.json
    _FORMULA_VAR_FILE: CMIP6_formula_terms.json 
    grids: CMIP6_grids.json
    # for CMIP6Plus use instead
    #_AXIS_ENTRY_FILE: MIP_coordinate.json
    #_FORMULA_VAR_FILE: MIP_formula_terms.json 
    #grids: MIP_grids.json
  # Additional NCI information:
    # NCI project to charge compute; $PROJECT = your default project
    project: <proj-id> 
    # additional NCI projects to be included in the storage flags, comma separated list
    addprojs: []
    # queue and memory (GB) per CPU (depends on queue) 
    # hugemem is recommended for high resolution data and/or derived variables
    # hugemem requires a minimum of 6 cpus this is handled by the code
    queue: hugemem
    mem_per_cpu: 32
    max_cpus: 24
    # Mopper uses multiprocessing to produce files in parallel, usually 1 cpu per worker
    # is a good compromise, occasionally you might want to pass a higher number
    # if running out of memory
    cpuxworker: 1
    # walltime in "hh:mm:ss"
    walltime: '8:00:00'
    mode: cmip6
    # if default uses xp62 conda env
    # conda_env to use by default xp62 analysis3
    # code needs to be installed by user
    # you can override that by supplying a custom env
    # Ex
    # conda_env: <custom-env-path> 
    # will add
    # "source ~/.bashrc
    # conda activate <custom-env>
    # to allow other settings use "test: true" and modify mopper_job.sh manually
    conda_env: default

# Global attributes: these will be added to each files comment unwanted ones
# the labels CMIP6/ACDD indicates which ones are necessary to comply with respective standards
# If CMIP6 for model information use CV vocab
# see data/custom-cmor-tables/Tables/CMIP6_CV.json
attrs:
    # contact email of person running post-processing
    # if following ACDD this is 
    contact: ..@..               
    # CMIP attribute refer to CMIP6 CV
    institution_id: CSIRO-ARCCSS
    institution: "CSIRO (Commonwealth Scientific and Industrial Research Organisation, Aspendale, Victoria 3195, Australia), ARCCSS (Australian Research Council Centre of Excellence for Climate System Science)"
    # use this license for CMIP6
    license: "CMIP6 model data produced by <institution> is licensed under a Creative Commons <license type> License (https://creativecommons.org/<license-code>). Consult https://pcmdi.llnl.gov/CMIP6/TermsOfUse for terms of use governing CMIP6 output, including citation requirements and proper acknowledgment. Further information about this data, including some limitations, can be found via the further_info_url (recorded as a global attribute in this file). The data producers and data providers make no warranty, either express or implied, including, but not limited to, warranties of merchantability and fitness for a particular purpose. All liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law."
    # Fill in institution and specific license Ex:
    #license: "CMIP6 model data produced by CSIRO is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License (https://creativecommons.org/licenses/). Consult https://pcmdi.llnl.gov/CMIP6/TermsOfUse for terms of use governing CMIP6 output, including citation requirements and proper acknowledgment.  Further information about this data, including some limitations, can be found via the further_info_url (recorded as a global attribute in this file). The data producers and data providers make no warranty, either express or implied, including, but not limited to, warranties of merchantability and fitness for a particular purpose. All liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law."
    # for CMIP6Plus
    # license: "CMIP6Plus model data produced by <institution> is licensed under a Creative Commons <license-type> License (https://creativecommons.org/<license-code>). Consult https://pcmdi.llnl.gov/CMIP6Plus/TermsOfUse for terms of use governing CMIP6Plus output, including citation requirements and proper acknowledgment. The data producers and data providers make no warranty, either express or implied, including, but not limited to, warranties of merchantability and fitness for a particular purpose. All liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law."
    # Title is not required but recommended
    title: "CSIRO ACCESS-CM2 model output prepared for CMIP6 CMIP piControl experiment"
    experiment: "pre-industrial control"
    experiment_id: piControl                   # standard experiment name (e.g. piControl)
    # Although optional a short description of the experiment is recommended 
    # exp_description:
    activity_id: CMIP                     
    mip_era: CMIP6
    # for CMIP6Plus
    #mip_era: CMIP6Plus
    realization_index: 1                          # "r1"[i1p1f1] (e.g. 1)
    initialization_index: 1                       # [r1]"i1"[p1f1] (e.g. 1)
    physics_index: 1                              # [r1i1]"p1"[f1] (e.g. 1)
    forcing_index: 1                              # [r1i1p1]"f1" (e.g. 1)
    variant_label: r1i1p1f1
    # not required for CMIP6Plus
    product: "model-output"
    source_type: AOGCM                           
    # NB source and source_id need to be defined in official CMIP6_CV.json 
    # currently available: ACCESS-ESM1-5, ACCESS-CM2,
    #                      ACCESS-OM2, ACCESS-OM2-025 
    source_id: ACCESS-CM2
    # ACCESS-CM2 description
    source: "ACCESS-CM2 (2019): aerosol: UKCA-GLOMAP-mode, atmos: MetUM-HadGEM3-GA7.1 (N96; 192 x 144 longitude/latitude; 85 levels; top level 85 km), atmosChem: none, land: CABLE2.5, landIce: none, ocean: ACCESS-OM2 (GFDL-MOM5, tripolar primarily 1deg; 360 x 300 longitude/latitude; 50 levels; top grid cell 0-10 m), ocnBgchem: none, seaIce: CICE5.1.2 (same grid as ocean)"
    # ACCESS-ESM1.5 description
    #source: "ACCESS-ESM1.5 (2019): aerosol: CLASSIC (v1.0), atmos: HadGAM2 (r1.1, N96; 192 x 145 longitude/latitude; 38 levels; top level 39255 m), atmosChem: none, land: CABLE2.4, landIce: none, ocean: ACCESS-OM2 (MOM5, tripolar primarily 1deg; 360 x 300 longitude/latitude; 50 levels; top grid cell 0-10 m), ocnBgchem: WOMBAT (same grid as ocean), seaIce: CICE4.1 (same grid as ocean)"
    # variant_info is not required but recommended  
    variant_info: "forcing: GHG, Oz, SA, Sl, Vl, BC, OC, (GHG = CO2, N2O, CH4, CFC11, CFC12, CFC113, HCFC22, HFC125, HFC134a)"
    calendar: "proleptic_gregorian"
    grid: "native atmosphere N96 grid (144x192 latxlon)"
    grid_label: "gn"
    nominal_resolution: "250 km"
    version: "v20220426"
    # Parent experiment details:
    # if parent=false, parent_experiment_id s set to "no parent"
    # and other "parent_***" attributes are ignored
    # If true, defined values are used.
    #
    parent: !!bool false 
    # experiment name of the parent (e.g. piControl-spinup)
    parent_experiment_id: none               
    # activity/MIP name of the parent (e.g. CMIP)
    parent_activity_id:                       
    # activity/MIP name of the parent (e.g. CMIP)
    parent_mip_era:                       
    parent_source_id:
    # time units of the parent (e.g. "days since 0001-01-01")
    parent_time_units:     
    # variable label of the parent (e.g. r1i1p1f1)
    parent_variant_label:                 
    # internal time of the child at which the branching occured (e.g. 0D0)
    branch_time_in_child: 0D0
    # internal time of the parent at which the branching occured (e.g. 0D0)
    branch_time_in_parent: 0D0    
    branch_method: standard
    sub_experiment: none
    sub_experiment_id: none
    # DO NOT REMOVE OR ALTER this if you don't know what you're doing :-)
    #CMOR will add a tracking_id if you want to define a prefix add here
    tracking_prefix: "hdl:21.14100"
    Conventions: "CF-1.7 CMIP-6.5" 
    comment: "post-processed using ACCESS-MOPPeR v1.2.0 https://doi.org/10.5281/zenodo.17886415"
